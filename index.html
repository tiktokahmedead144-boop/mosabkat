<!doctype html>
<html lang="ar" dir="rtl"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title> ููุตุฉ ุงุฌุชุงุฒ ุงูุชุนููููุฉ | ุงููููุงุช ูุงูุงุฎุชุจุงุฑุงุช </title> 
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script> 
  <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            800: '#166534',
                            900: '#14532d',
                        }
                    },
                    animation: {
                        'bounce-in': 'bounceIn 0.5s cubic-bezier(0.8, 0, 1, 1)',
                    },
                    keyframes: {
                        bounceIn: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&amp;display=swap" rel="stylesheet"> 
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script> 
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6559290623041201" crossorigin="anonymous"></script>

  <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f4f7f6; user-select: none; -webkit-user-select: none; }
        .hidden { display: none !important; }
        .modal-animate { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .locked-item { opacity: 0.7; filter: grayscale(90%); cursor: not-allowed; position: relative; transition: all 0.3s; }
        .locked-item:hover { transform: none !important; }
        .locked-item::after { content: '\f023'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); font-size: 2rem; color: #ef4444; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .opt-btn { width: 100%; padding: 1.25rem; border: 2px solid #e2e8f0; border-radius: 1rem; font-weight: bold; transition: all 0.2s; background: white; text-align: right; position: relative; overflow: hidden; }
        .opt-btn:hover:not(:disabled) { border-color: #22c55e; background: #f0fdf4; }
        .correct { background: #d1fae5 !important; border-color: #10b981 !important; color: #065f46; }
        .wrong { background: #fee2e2 !important; border-color: #ef4444 !important; color: #991b1b; }
        #toast-notification { position: fixed; top: 20px; left: 50%; transform: translate(-50%, -200%); z-index: 99999; transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); display: flex; align-items: center; gap: 12px; padding: 16px 30px; border-radius: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.15); color: white; font-weight: bold; min-width: 320px; justify-content: center; font-size: 1.1rem; backdrop-filter: blur(5px); }
        #toast-notification.show { transform: translate(-50%, 0); }
        .review-card.correct-ans { border-right: 6px solid #10b981; background: #f0fdf4; }
        .review-card.wrong-ans { border-right: 6px solid #ef4444; background: #fef2f2; }
        .contact-float { position: fixed; bottom: 25px; left: 25px; z-index: 50; display: flex; flex-direction: column; gap: 12px; }
        .contact-btn { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; color: white; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); cursor: pointer; text-decoration: none; }
        .contact-btn:hover { transform: scale(1.1) translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .whatsapp-float { background-color: #25D366; }
        .telegram-float { background-color: #0088cc; }
        /* Performance Optimizations */
        .view-section { content-visibility: auto; contain-intrinsic-size: 1px 500px; }
    </style> 
 </head> 
 <body class="text-slate-800 pb-24" oncontextmenu="return false;"> 
  <div id="toast-notification" class="bg-slate-800"> <i id="toast-icon" class="text-2xl"></i> <span id="toast-msg"></span> 
  </div> 
  <div id="custom-alert-modal" class="fixed inset-0 bg-slate-900/95 backdrop-blur z-[200] hidden flex items-center justify-center p-6"> 
   <div class="bg-white p-8 rounded-[2rem] shadow-2xl w-full max-w-sm text-center animate-bounce-in border-4 border-red-100 relative"> 
    <div class="w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner"> <i class="fas fa-user-shield text-5xl text-red-500"></i> 
    </div> 
    <h3 class="text-2xl font-black text-slate-800 mb-2">ุชูุจูู ุฃููู</h3> 
    <p id="custom-alert-msg" class="text-slate-500 font-bold mb-8 leading-relaxed text-sm"></p> <button onclick="location.reload()" class="w-full bg-slate-800 text-white py-4 rounded-xl font-black shadow-lg hover:bg-slate-900 transition-all transform hover:scale-[1.02]"> <i class="fas fa-redo ml-2"></i> ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ </button> 
   </div> 
  </div> 
  <div class="contact-float"> <a id="whatsapp-link" href="#" target="_blank" class="contact-btn whatsapp-float hidden" title="ุชูุงุตู ุนุจุฑ ูุงุชุณุงุจ"> <i class="fab fa-whatsapp"></i> </a> <a id="telegram-link" href="#" target="_blank" class="contact-btn telegram-float hidden" title="ุชุงุจุนูุง ุนูู ุชููุฌุฑุงู"> <i class="fab fa-telegram-plane"></i> </a> 
  </div> 
  <div id="loading" class="fixed inset-0 bg-white z-[999] flex flex-col items-center justify-center transition-opacity duration-500"> 
   <div class="w-20 h-20 border-8 border-brand-500 border-t-transparent rounded-full animate-spin mb-6"></div> 
   <p id="loading-text" class="font-black text-slate-400 text-lg animate-pulse">ุฌุงุฑู ุชุฌููุฒ ุงูููุตุฉ...</p> <button id="retry-btn" onclick="location.reload()" class="hidden mt-6 bg-red-50 text-red-500 px-6 py-2 rounded-full font-bold text-sm border border-red-100 hover:bg-red-100"> <i class="fas fa-wifi"></i> ุฅุนุงุฏุฉ ุงูุงุชุตุงู </button> 
  </div> 
  <div id="app-banner" class="hidden p-3 bg-gradient-to-r from-slate-900 to-slate-800 text-white sticky top-0 z-50 shadow-lg border-b border-slate-700"> 
   <div class="container mx-auto flex justify-between items-center px-4"> <span class="font-bold text-xs md:text-sm flex items-center gap-2"><i class="fas fa-mobile-alt"></i> <span id="ui-app-text"></span></span> <a id="ui-app-link" href="#" target="_blank" class="bg-yellow-400 text-slate-900 px-5 py-1.5 rounded-full text-xs font-black hover:bg-yellow-300 transition-colors">ุชูุฒูู ุงูุชุทุจูู</a> 
   </div> 
  </div> 
  <nav class="bg-white border-b-4 border-brand-500 p-4 shadow-sm relative z-40"> 
   <div class="container mx-auto flex justify-between items-center"> 
    <h1 class="text-xl md:text-2xl font-black text-brand-800 cursor-pointer flex items-center gap-2" onclick="location.reload()"> <i class="fas fa-graduation-cap text-brand-500"></i> <span id="ui-site-name">ุงูููุตุฉ ุงูุชุนููููุฉ</span> </h1> 
   </div> 
  </nav> 
  
  <main class="container mx-auto px-4 py-8 space-y-8 min-h-screen"> 

   <section id="landing" class="view-section hidden space-y-12"> 
    <div class="text-center text-slate-600 mb-4 max-w-3xl mx-auto text-sm opacity-50">
        ูุฑุญุจุงู ุจู ูู ููุตุฉ ุงุฌุชุงุฒ ุงูุชุนููููุฉ. ูููุฑ ุฃูุถู ุงููุญุงููุงุช ูุงุฎุชุจุงุฑุงุช ุงูุชูุธูู ูุงูุฅุฏุงุฑุฉุ ุจููู ุฃุณุฆูุฉ ุดุงููุฉ ููุชุฎุตุตุ ุงูุชุฑุจููุ ุงูุฌุฏุงุฑุงุช ุงูุณููููุฉุ ุญุงุณุจ ุขููุ ูุบุงุช ูุงุฎุชุจุงุฑุงุช ุงูุฐูุงุก IQ. ุงุดุชุฑู ุงูุขู ูููุตูู ุฅูู ูุงูุฉ ุงููููุงุช ูุงูุงุฎุชุจุงุฑุงุช ุงูุญุตุฑูุฉ.
    </div>

    <div class="text-center space-y-4 pt-8"> 
     <h2 class="text-4xl md:text-7xl font-black text-slate-900 tracking-tight" id="ui-hero-title"></h2> 
     <p class="text-slate-500 font-bold text-xl md:text-2xl max-w-2xl mx-auto" id="ui-hero-desc"></p> 
    </div> 
    <div id="ui-tutorial-box" class="hidden bg-blue-50 border-r-8 border-blue-600 p-8 rounded-3xl max-w-3xl mx-auto shadow-sm"> 
     <h4 class="font-black text-blue-900 mb-2 flex items-center gap-2"><i class="fas fa-info-circle"></i> ุชูููู ูุงู:</h4> 
     <p id="ui-tutorial-text" class="font-bold text-slate-700 leading-relaxed text-lg"></p> 
    </div> 
    <div id="ui-ext-link-area" class="hidden text-center"> <a id="ui-ext-link" href="#" target="_blank" class="inline-flex items-center gap-3 bg-slate-900 text-white px-8 py-4 rounded-2xl font-black shadow-xl hover:scale-105 transition-all ring-4 ring-slate-100"> <i class="fas fa-external-link-alt text-yellow-400"></i> <span id="ui-ext-text"></span> </a> 
    </div> 
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto pb-10"> 
     <div onclick="app.enterVisitor()" class="group bg-white p-10 rounded-[3rem] shadow-xl border-b-[10px] border-slate-200 cursor-pointer hover:-translate-y-2 transition-all text-center relative overflow-hidden"> 
      <div class="absolute inset-0 bg-slate-50 opacity-0 group-hover:opacity-100 transition-opacity"></div> 
      <div class="relative z-10"> 
       <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform"> <i class="fas fa-user-graduate text-5xl text-slate-400"></i> 
       </div> 
       <h3 class="text-3xl font-black text-slate-700" id="ui-btn-vis">ุฏุฎูู ูุฒุงุฆุฑ</h3> 
       <p class="text-slate-400 font-bold mt-2 text-sm">ุชุตูุญ ุงููุญุชูู ุงููุฌุงูู ุงููุชุงุญ</p> 
      </div> 
     </div> 
     <div onclick="app.enterSubscriber()" class="group bg-white p-10 rounded-[3rem] shadow-xl border-b-[10px] border-brand-500 cursor-pointer hover:-translate-y-2 transition-all text-center relative overflow-hidden"> 
      <div class="absolute inset-0 bg-green-50 opacity-0 group-hover:opacity-100 transition-opacity"></div> 
      <div class="relative z-10"> 
       <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform"> <i class="fas fa-crown text-5xl text-brand-600 animate-pulse"></i> 
       </div> 
       <h3 class="text-3xl font-black text-brand-800" id="ui-btn-sub">ุฏุฎูู ุงููุดุชุฑููู</h3> 
       <p class="text-green-600/70 font-bold mt-2 text-sm">ูููุตูู ุงููุงูู ููู ุงูุงุฎุชุจุงุฑุงุช</p> 
      </div> 
     </div> 
    </div> 
   </section> 
   <section id="dashboard" class="view-section hidden space-y-8 animate-fadeIn"> 
    <div class="bg-white p-6 rounded-3xl shadow-sm flex flex-col md:flex-row justify-between items-center gap-4 border border-slate-100"> 
     <div class="flex items-center gap-3"> 
      <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center"> <i class="fas fa-user text-slate-500"></i> 
      </div> <span id="user-status" class="font-black text-lg text-slate-700"></span> 
     </div> <button onclick="app.logoutForce()" class="bg-red-50 text-red-500 px-6 py-3 rounded-2xl font-bold text-sm hover:bg-red-500 hover:text-white transition-all w-full md:w-auto flex items-center justify-center gap-2"><i class="fas fa-sign-out-alt"></i> ุฎุฑูุฌ ุขูู</button> 
    </div> 
    <div onclick="app.openSimulationsSection()" class="w-full bg-slate-800 text-white p-8 rounded-[2rem] shadow-lg border-l-8 border-yellow-400 cursor-pointer hover:-translate-y-1 transition-all group relative overflow-hidden"> 
     <div class="absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> 
     <div class="flex items-center justify-between relative z-10"> 
      <div class="flex items-center gap-6"> 
       <div class="bg-slate-700 p-4 rounded-full group-hover:bg-slate-600 transition-colors shadow-lg"> <i class="fas fa-bolt text-4xl text-yellow-400 animate-pulse"></i> 
       </div> 
       <div class="text-right"> 
        <h3 class="text-2xl md:text-3xl font-black mb-2">ูุญุงููุงุช ุงูุชูุธูู ูุงูุฅุฏุงุฑุฉ</h3> 
        <p class="text-slate-300 font-bold text-sm md:text-base">ุงุฎุชุจุงุฑุงุช ูุญุงูุงุฉ ุดุงููุฉ ูููููุชุฉ ูุฌููุน ุงูุชุฎุตุตุงุช</p> 
       </div> 
      </div> 
      <div class="bg-slate-900/50 p-4 rounded-xl hidden md:block"> <i class="fas fa-arrow-left text-2xl text-slate-400 group-hover:text-white transition-colors"></i> 
      </div> 
     </div> 
    </div> 
    <div class="text-center py-4 border-t border-slate-200 mt-8 pt-8"> <span class="bg-slate-100 text-slate-500 px-4 py-1 rounded-full text-xs font-bold">ุชุตูุญ ุงูุฃูุณุงู</span> 
     <h2 class="text-3xl font-black text-slate-800 mt-2">ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ</h2> 
    </div> 
    <div id="majors-grid" class="grid grid-cols-2 md:grid-cols-3 gap-5"></div> 
   </section> 
   <section id="simulations-view" class="view-section hidden space-y-6"> 
    <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm"> 
     <h3 class="font-black text-xl text-slate-800 flex items-center gap-2"> <i class="fas fa-bolt text-yellow-500"></i> ูุญุงููุงุช ุงูุชูุธูู ูุงูุฅุฏุงุฑุฉ </h3> <button onclick="app.showSection('dashboard')" class="text-blue-600 bg-blue-50 px-4 py-2 rounded-xl font-bold text-sm hover:bg-blue-100">ุฑุฌูุน ูููุงุฆูุฉ</button> 
    </div> 
    <div id="simulations-list" class="grid grid-cols-1 gap-4"></div> 
   </section> 
   <section id="sub-dashboard" class="view-section hidden space-y-6"> 
    <div class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm"> 
     <h3 id="major-title" class="font-black text-xl text-slate-800"></h3> <button onclick="app.showSection('dashboard')" class="text-blue-600 bg-blue-50 px-4 py-2 rounded-xl font-bold text-sm hover:bg-blue-100">ุชุบููุฑ ุงููุณู</button> 
    </div> 
    <div id="sub-sections-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> 
    </div> 
   </section> 
   <section id="content-list" class="view-section hidden space-y-8"> 
    <div class="flex justify-between items-center mb-4 bg-white p-4 rounded-2xl shadow-sm"> 
     <h3 id="list-title" class="font-black text-lg text-brand-800"></h3> <button onclick="app.backFromContent()" class="bg-slate-100 px-4 py-2 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-200">ุฑุฌูุน</button> 
    </div> 
    <div id="files-box" class="hidden"> 
     <h4 class="font-black text-red-600 mb-4 flex items-center gap-2 text-xl border-b pb-2"><i class="fas fa-folder-open"></i> ุงููููุงุช ุงููุชุงุญุฉ:</h4> 
     <div id="files-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div> 
    </div> 
    <div id="quizzes-box"> 
     <h4 class="font-black text-blue-600 mb-4 flex items-center gap-2 text-xl border-b pb-2"><i class="fas fa-list-check"></i> ุงูุงุฎุชุจุงุฑุงุช ุงููุชุงุญุฉ:</h4> 
     <div id="quizzes-grid" class="space-y-4"></div> 
    </div> 
   </section> 
   <section id="exam-player" class="view-section hidden max-w-3xl mx-auto space-y-6"> 
    <div class="bg-white p-6 rounded-[2rem] shadow-xl border-t-8 border-brand-500 sticky top-24 z-30"> 
     <div class="flex justify-between mb-4 items-center"> <span id="timer-display" class="font-black text-red-500 text-2xl font-mono hidden tracking-widest bg-red-50 px-3 py-1 rounded-lg">00:00</span> <span id="progress-text" class="text-sm font-black text-brand-700 bg-brand-50 px-3 py-1 rounded-full"></span> <button onclick="app.returnToHome()" class="text-xs font-bold text-red-400 hover:text-red-600 bg-red-50 px-3 py-1 rounded-lg">ุงูุณุญุงุจ</button> 
     </div> 
     <div class="w-full h-3 bg-slate-100 rounded-full overflow-hidden"> 
      <div id="progress-bar" class="h-full bg-brand-500 transition-all duration-500 ease-out shadow-[0_0_10px_#22c55e]" style="width: 0%"></div> 
     </div> 
    </div> 
    <div id="question-box" class="animate-slideUp"></div> 
    <div id="result-box" class="hidden text-center space-y-8 animate-fadeIn"> 
     <div class="bg-white p-10 rounded-[3rem] shadow-2xl border-t-[12px] border-brand-500 relative overflow-hidden"> 
      <div class="absolute top-0 left-0 w-full h-full bg-brand-50 opacity-20 pointer-events-none" style="background-image: radial-gradient(#22c55e 1px, transparent 1px); background-size: 20px 20px;"></div> <i class="fas fa-award text-7xl text-yellow-400 mb-6 block animate-bounce drop-shadow-lg"></i> 
      <h2 class="text-3xl font-black mb-2 text-slate-800">ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ</h2> 
      <p id="res-score" class="text-7xl font-black text-brand-600 mb-6 font-mono tracking-tighter"></p> 
      <p id="res-msg" class="text-xl font-bold text-slate-600 mb-8 bg-slate-50 py-3 rounded-2xl"></p> <button onclick="app.returnToHome()" class="bg-slate-900 text-white px-10 py-4 rounded-full font-black shadow-lg hover:bg-black hover:scale-105 transition-all">ุงูุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</button> 
     </div> 
     <div class="text-right"> 
      <h3 class="font-black text-2xl text-slate-700 mb-6 border-r-8 border-blue-500 pr-4 flex items-center gap-3 bg-white p-4 rounded-xl shadow-sm"><i class="fas fa-history text-blue-500"></i> ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช ุงูุชูุตูููุฉ</h3> 
      <div id="review-list" class="space-y-5"></div> 
     </div> 
    </div> 
   </section> 

   <section id="about-us" class="view-section hidden space-y-6 max-w-4xl mx-auto">
       <div class="bg-white p-8 md:p-12 rounded-[2rem] shadow-sm border border-slate-100">
           <div class="flex justify-between items-center mb-8 border-b pb-4">
               <h2 class="text-3xl font-black text-slate-800"><i class="fas fa-users text-brand-500 ml-2"></i> ูู ูุญู</h2>
               <button onclick="app.showSection('landing')" class="text-slate-500 bg-slate-100 px-4 py-2 rounded-xl font-bold hover:bg-slate-200">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
           </div>
           <div class="prose prose-slate prose-lg rtl:prose-invert max-w-none space-y-6 text-slate-600 font-bold leading-relaxed text-right">
               <h3 class="text-2xl font-black text-brand-600 mb-4">ูุฑุญุจุงู ุจู ูู ููุตุฉ "ุงุฌุชุงุฒ" ุงูุชุนููููุฉ</h3>
               <p><strong>"ุงุฌุชุงุฒ"</strong> ูู ููุตุฉ ุชุนููููุฉ ูุชุฏุฑูุจูุฉ ุฅููุชุฑูููุฉ ูุชุทูุฑุฉุ ุชุฃุณุณุช ุจุฑุคูุฉ ูุฅุดุฑุงู <strong>ุฃ. ุฃุญูุฏ ุนูุฏ</strong>ุ ูุชูุฏู ุจุดูู ุฃุณุงุณู ุฅูู ูุณุงุนุฏุฉ ุงูุทูุงุจ ูุงูุฎุฑูุฌูู ูู ุงูุชุญุถูุฑ ุงูุฃูุซู ููุงูุชุญุงูุงุช ุงูุชูุงูุณูุฉ (ูุซู ูุณุงุจูุงุช ุงูุชูุธูู ูุงูุฅุฏุงุฑุฉ) ูู ูุฎุชูู ุงูุชุฎุตุตุงุช.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6"><i class="fas fa-bullseye text-red-500 ml-2"></i> ุฑุณุงูุชูุง ูุฃูุฏุงููุง</h3>
               <p>ูุฏุฑู ุชูุงูุงู ุญุฌู ุงูุถุบุท ุงูุฐู ููุงุฌูู ุงููุชูุฏููู ููุงูุชุญุงูุงุช ุงูุฑุณููุฉุ ูุฐุง ุฃุฎุฐูุง ุนูู ุนุงุชููุง ุชูููุฑ ุจูุฆุฉ ูุญุงูุงุฉ ูุงูุนูุฉ ุชุถุน ุงููุชุฏุฑุจ ูู ุฃุฌูุงุก ุงูุงุฎุชุจุงุฑ ุงูุญูููู. ูุฏููุง ูู ูุณุฑ ุญุงุฌุฒ ุงูุฑูุจุฉุ ูุชุฏุฑูุจ ุงููุดุชุฑููู ุนูู ุฅุฏุงุฑุฉ ุงูููุช ุจูุงุนููุฉุ ูููุงุณ ูุณุชูุงูู ุจุดูู ุฏููู ูุจู ุฎูุถ ุงูุงูุชุญุงูุงุช ุงููุนููุฉ.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6"><i class="fas fa-gem text-blue-500 ml-2"></i> ูุงุฐุง ููุฏูุ</h3>
               <ul class="list-disc list-inside space-y-2 mt-2">
                   <li><strong>ูุญุงููุงุช ุฐููุฉ ูููููุชุฉ:</strong> ุงุฎุชุจุงุฑุงุช ุฅููุชุฑูููุฉ ุญุตุฑูุฉ ูุดุงููุฉ (ุชุฎุตุตุ ุชุฑุจููุ ุฌุฏุงุฑุงุชุ ุญุงุณุจ ุขููุ ูุบุงุชุ ูIQ) ูุตููุฉ ุจุนูุงูุฉ ูุชุฏุฑูุจู ุนูู ุดูู ูููุท ุงูุฃุณุฆูุฉ.</li>
                   <li><strong>ููุชุจุฉ ูููุงุช ูุชูุงููุฉ:</strong> ุชุฌููุนุงุช ูุฃูู ุงููุฐูุฑุงุช ููููุงุช ุงูู PDF ุงูุชุนููููุฉ ูุชููู ูุฑุฌุนู ุงูุณุฑูุน ูููุฑุงุฌุนุฉ ูู ููุงู ูุงุญุฏ.</li>
                   <li><strong>ุชูููู ููุฑู:</strong> ูุธุงู ุขูู ูููุญู ูุชูุฌุชู ููุฑ ุงูุชูุงุก ุงูุงุฎุชุจุงุฑ ูุน ุฅููุงููุฉ ูุฑุงุฌุนุฉ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ ูุงูุฎุงุทุฆุฉ ูููููู ุนูู ููุงุท ุงูุถุนู ููุนุงูุฌุชูุง.</li>
               </ul>
               <h3 class="text-xl font-black text-slate-800 mt-6"><i class="fas fa-handshake text-green-500 ml-2"></i> ุชูุงุตู ูุน ุงูุฅุฏุงุฑุฉ</h3>
               <p>ูุนูู ุฏุงุฆูุงู ุนูู ุชุทููุฑ ุงูููุตุฉ ูุชุญุฏูุซ ุงููุญุชููุ ููุณุนุฏ ุจุชููู ููุชุฑุญุงุชูู ูุงุณุชูุณุงุฑุงุชูู ุนุจุฑ ูููุงุช ุงูุชูุงุตู ุงูุฑุณููุฉ:</p>
               <ul class="list-none space-y-2 mt-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
                   <li><i class="fas fa-envelope text-brand-500 ml-2"></i> <strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> Ahmedead112233@gmail.com</li>
                   <li><i class="fas fa-phone text-brand-500 ml-2"></i> <strong>ุงููุงุชู / ูุงุชุณุงุจ:</strong> 01126874320</li>
               </ul>
           </div>
       </div>
   </section>

   <section id="privacy-policy" class="view-section hidden space-y-6 max-w-4xl mx-auto">
       <div class="bg-white p-8 md:p-12 rounded-[2rem] shadow-sm border border-slate-100">
           <div class="flex justify-between items-center mb-8 border-b pb-4">
               <h2 class="text-3xl font-black text-slate-800"><i class="fas fa-shield-alt text-brand-500 ml-2"></i> ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</h2>
               <button onclick="app.showSection('landing')" class="text-slate-500 bg-slate-100 px-4 py-2 rounded-xl font-bold hover:bg-slate-200">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
           </div>
           <div class="prose prose-slate prose-lg rtl:prose-invert max-w-none space-y-6 text-slate-600 font-bold leading-relaxed text-right">
               <p>ูู ููุตุฉ <strong>"ุงุฌุชุงุฒ"</strong> ุงูุชุนููููุฉุ ุชุนุชุจุฑ ุฎุตูุตูุฉ ุฒูุงุฑูุง ููุดุชุฑูููุง ูู ุฃูู ุฃููููุงุชูุง. ุชูุถุญ ูุซููุฉ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุฐู ุฃููุงุน ุงููุนูููุงุช ุงูุดุฎุตูุฉ ุงูุชู ูุชููุงูุง ููุฌูุนูุง ูููููุฉ ุงุณุชุฎุฏุงููุง.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">1. ูููุงุช ุงูุฏุฎูู (Log Files)</h3>
               <p>ูุซู ุงูุนุฏูุฏ ูู ููุงูุน ุงูููุจ ุงูุฃุฎุฑูุ ุชุณุชุฎุฏู ููุตุฉ "ุงุฌุชุงุฒ" ูููุงุช ุงูุฏุฎูู. ุชุดูู ุงููุนูููุงุช ุงูููุฌูุฏุฉ ุฏุงุฎู ูููุงุช ุงูุฏุฎูู ุนูุงููู ุจุฑูุชูููู ุงูุฅูุชุฑูุช (IP)ุ ููุน ุงููุชุตูุญุ ูุฒูุฏ ุฎุฏูุฉ ุงูุฅูุชุฑูุช (ISP)ุ ุทุงุจุน ุงูุชุงุฑูุฎ/ุงูููุชุ ุตูุญุงุช ุงูุฅุญุงูุฉ/ุงูุฎุฑูุฌุ ูุนุฏุฏ ุงูููุฑุงุช ูุชุญููู ุงูุงุชุฌุงูุงุช ูุฅุฏุงุฑุฉ ุงููููุน. ูุฐู ุงููุนูููุงุช ููุณุช ูุฑุชุจุทุฉ ุจุฃู ูุนูููุงุช ูุชุญุฏูุฏ ุงููููุฉ ุงูุดุฎุตูุฉ.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">2. ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท (Cookies)</h3>
               <p>ุชุณุชุฎุฏู ููุตุฉ "ุงุฌุชุงุฒ" ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท (Cookies) ูุชุฎุฒูู ุงููุนูููุงุช ุญูู ุชูุถููุงุช ุงูุฒูุงุฑุ ูุชุณุฌูู ูุนูููุงุช ุฎุงุตุฉ ุจุงููุณุชุฎุฏู ูุชุฎุตูุต ูุญุชูู ุตูุญุฉ ุงูููุจ ูุจูุงุก ุชุฌุฑุจุฉ ุชุนููููุฉ ุณูุณุฉ.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">3. ุฅุนูุงูุงุช ุฌูุฌู ุฃุฏุณูุณ (Google AdSense)</h3>
               <ul class="list-disc list-inside space-y-2 mt-2">
                   <li>ูุญู ูุณุชุฎุฏู ุดุฑูุงุช ุฅุนูุงู ูุทุฑู ุซุงูุซ (ูุซู Google) ูุนุฑุถ ุงูุฅุนูุงูุงุช ุนูุฏูุง ุชุฒูุฑ ููุตุชูุง.</li>
                   <li>ุจุตูุชูุง ููุฑุฏุงู ุฎุงุฑุฌูุงูุ ุชุณุชุฎุฏู Google ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท (Cookies) ูุนุฑุถ ุงูุฅุนูุงูุงุช ุนูู ููุตุชูุง.</li>
                   <li>ูุชูุญ ุงุณุชุฎุฏุงู Google ูููู ุชุนุฑูู ุงูุงุฑุชุจุงุท DART ุนุฑุถ ุงูุฅุนูุงูุงุช ูููุณุชุฎุฏููู ุจูุงุกู ุนูู ุฒูุงุฑุชูู ูููุตุชูุง.</li>
                   <li>ูููู ูููุณุชุฎุฏููู ุงุฎุชูุงุฑ ุนุฏู ุงุณุชุฎุฏุงู ููู ุชุนุฑูู ุงูุงุฑุชุจุงุท DART ุนู ุทุฑูู ุฒูุงุฑุฉ ุณูุงุณุฉ ุฅุนูุงูุงุช Google.</li>
               </ul>
               <h3 class="text-xl font-black text-slate-800 mt-6">4. ููุงููุชู</h3>
               <p>ุจุงุณุชุฎุฏุงูู ูููุตุชูุง ุงูุชุนููููุฉ "ุงุฌุชุงุฒ"ุ ูุฅูู ุชูุงูู ุจููุฌุจ ูุฐุง ุนูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ุงูุฎุงุตุฉ ุจูุง ูุชูุงูู ุนูู ุดุฑูุทูุง.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">5. ุงุชุตู ุจูุง</h3>
               <p>ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุฒูุฏ ูู ุงููุนูููุงุช ุฃู ูุฏูู ุฃูุฉ ุฃุณุฆูุฉ ุญูู ุณูุงุณุฉ ุงูุฎุตูุตูุฉุ ุชูุงุตู ูุนูุง:</p>
               <ul class="list-none space-y-2 mt-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
                   <li><i class="fas fa-envelope text-brand-500 ml-2"></i> <strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> Ahmedead112233@gmail.com</li>
                   <li><i class="fas fa-phone text-brand-500 ml-2"></i> <strong>ุงููุงุชู / ูุงุชุณุงุจ:</strong> 01126874320</li>
               </ul>
           </div>
       </div>
   </section>

   <section id="terms-of-use" class="view-section hidden space-y-6 max-w-4xl mx-auto">
       <div class="bg-white p-8 md:p-12 rounded-[2rem] shadow-sm border border-slate-100">
           <div class="flex justify-between items-center mb-8 border-b pb-4">
               <h2 class="text-3xl font-black text-slate-800"><i class="fas fa-file-contract text-brand-500 ml-2"></i> ุดุฑูุท ุงูุงุณุชุฎุฏุงู</h2>
               <button onclick="app.showSection('landing')" class="text-slate-500 bg-slate-100 px-4 py-2 rounded-xl font-bold hover:bg-slate-200">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</button>
           </div>
           <div class="prose prose-slate prose-lg rtl:prose-invert max-w-none space-y-6 text-slate-600 font-bold leading-relaxed text-right">
               <p>ูุฑุญุจุงู ุจู ูู ููุตุฉ <strong>"ุงุฌุชุงุฒ"</strong> ุงูุชุนููููุฉ. ุจุงุณุชุฎุฏุงูู ููุฐู ุงูููุตุฉุ ูุฅูู ุชูุงูู ุนูู ุงูุงูุชุฒุงู ุจุงูุดุฑูุท ูุงูุฃุญูุงู ุงูุชุงููุฉ:</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">1. ุญููู ุงูููููุฉ ุงูููุฑูุฉ</h3>
               <ul class="list-disc list-inside space-y-2 mt-2">
                   <li><strong>ุงูุงุฎุชุจุงุฑุงุช ูุงููุญุงููุงุช (ูุญุชูู ุญุตุฑู):</strong> ุฌููุน ุงูุฃุณุฆูุฉุ ุงูุงุฎุชุจุงุฑุงุช ุงูุฅููุชุฑูููุฉุ ุงููุญุงููุงุชุ ุงูุฃููุงุฏ ุงูุจุฑูุฌูุฉุ ูุชุตููู ุงูููุตุฉ ูู ููููุฉ ููุฑูุฉ ุญุตุฑูุฉ ูููุตุฉ "ุงุฌุชุงุฒ". ููููุน ููุนุงู ุจุงุชุงู ูุณุฎูุง ุฃู ุฅุนุงุฏุฉ ูุดุฑูุง ุฃู ุงุณุชุบูุงููุง ุชุฌุงุฑูุงู ุฏูู ุฅุฐู ูุณุจู.</li>
                   <li><strong>ุงููููุงุช ูุงููุฐูุฑุงุช (ูุญุชูู ุบูุฑ ุญุตุฑู):</strong> ุชููุฑ ุงูููุตุฉ ูุฌููุนุฉ ูู ูููุงุช (PDF) ูุงููุฐูุฑุงุช ุงูุชุนููููุฉ ูุชุณููู ุงููุฐุงูุฑุฉ ุนูู ุงูุทูุงุจ. ูุฐู ุงููููุงุช ุชู ุชุฌููุนูุง ูููุงุฆุฏุฉ ุงูุนุงูุฉ ููุง ุชุฏุนู ููุตุฉ "ุงุฌุชุงุฒ" ููููุชูุง ุงูุญุตุฑูุฉุ ูุชุนูุฏ ุญููููุง ุงูููุฑูุฉ ููุคููููุง ุงูุฃุตูููู.</li>
               </ul>
               <h3 class="text-xl font-black text-slate-800 mt-6">2. ุญุณุงุจุงุช ุงููุดุชุฑููู (VIP)</h3>
               <p>ุงูุญุณุงุจ ุดุฎุตู ูููุณูุญ ุจุงุณุชุฎุฏุงูู ูู ูุจู ุดุฎุต ูุงุญุฏ ูุนูู ุฌูุงุฒ ูุงุญุฏ ููุท ูู ููุณ ุงูููุช. ูุดุงุฑูุฉ ุจูุงูุงุช ุงูุญุณุงุจ ูุน ุฃุดุฎุงุต ุขุฎุฑูู ุชุคุฏู ุฅูู ุงูุฅููุงู ุงูููุฑู ููุญุณุงุจ ูู ูุจู ุงููุธุงู ุฏูู ุชุนููุถ ูุงูู.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">3. ุฅุฎูุงุก ุงููุณุคูููุฉ</h3>
               <p>ููุตุฉ "ุงุฌุชุงุฒ" ูู ุฃุฏุงุฉ ุชุนููููุฉ ูุชุฏุฑูุจูุฉ ูุณุงุนุฏุฉ. ูุญู ูุง ูุถูู ุจุดูู ูุงุทุน ุฃู ุงุฌุชูุงุฒู ููุงุฎุชุจุงุฑุงุช ุนูู ุงูููุตุฉ ูุนูู ุจุงูุถุฑูุฑุฉ ุงุฌุชูุงุฒู ููุงูุชุญุงูุงุช ุงูุฑุณููุฉ ุฃู ุงููุนููุฉ.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">4. ุฅุนูุงูุงุช ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ</h3>
               <p>ูุญู ูุณุชุฎุฏู ุฅุนูุงูุงุช ูุฌูุงุช ุฎุงุฑุฌูุฉ (ูุซู Google). ููููุน ุฃู ุชูุงุนุจ ุฃู ุงุณุชุฎุฏุงู ูุจุฑุงูุฌ ุชููุงุฆูุฉ ููููุฑ ุนูู ูุฐู ุงูุฅุนูุงูุงุช.</p>
               <h3 class="text-xl font-black text-slate-800 mt-6">5. ุงูุชูุงุตู ูุงูุฏุนู ุงูููู</h3>
               <p>ูุฃู ุงุณุชูุณุงุฑุงุชุ ูููููู ุงูุชูุงุตู ูุน ุฅุฏุงุฑุฉ ุงูููุตุฉ ุนุจุฑ:</p>
               <ul class="list-none space-y-2 mt-2 bg-slate-50 p-4 rounded-xl border border-slate-200">
                   <li><i class="fas fa-envelope text-brand-500 ml-2"></i> <strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> Ahmedead112233@gmail.com</li>
                   <li><i class="fas fa-phone text-brand-500 ml-2"></i> <strong>ุงููุงุชู / ูุงุชุณุงุจ:</strong> 01126874320</li>
               </ul>
           </div>
       </div>
   </section>
  </main> 

  <footer class="bg-white border-t py-6 mt-12"> 
   <div class="container mx-auto px-6 flex flex-col items-center justify-center gap-4"> 
    <div class="flex flex-wrap justify-center gap-4 md:gap-6 text-sm font-bold text-slate-500">
        <a href="#" onclick="app.showSection('landing'); return false;" class="hover:text-brand-500">ุงูุฑุฆูุณูุฉ</a>
        <a href="#" onclick="app.showSection('about-us'); return false;" class="hover:text-brand-500">ูู ูุญู</a>
        <a href="#" onclick="app.showSection('privacy-policy'); return false;" class="hover:text-brand-500">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a>
        <a href="#" onclick="app.showSection('terms-of-use'); return false;" class="hover:text-brand-500">ุดุฑูุท ุงูุงุณุชุฎุฏุงู</a>
    </div>
    <p id="footer-text" class="text-sm font-bold text-slate-400"></p> 
   </div> 
  </footer> 

  <div id="subscriber-login-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4 transition-opacity duration-300"> 
   <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-sm text-center shadow-2xl modal-animate border-4 border-white ring-4 ring-brand-100"> 
    <div class="w-16 h-16 bg-brand-50 rounded-full flex items-center justify-center mx-auto mb-4"> <i class="fas fa-lock text-3xl text-brand-500"></i> 
    </div> 
    <h3 class="text-2xl font-black mb-2 text-slate-800">ููุทูุฉ ุงููุดุชุฑููู</h3> 
    <p class="text-slate-400 text-sm mb-6 font-bold">ุฌูุณุฉ ูุงุญุฏุฉ ุขููุฉ ููู ุฌูุงุฒ</p> 
    <div class="space-y-4"> 
     <div class="relative"> <i class="fas fa-user absolute top-4 right-4 text-slate-400"></i> 
      <input type="text" id="sub-user" placeholder="ุงุณู ุงููุณุชุฎุฏู" class="w-full border-2 border-slate-200 p-3 pr-10 rounded-xl font-bold outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all bg-slate-50 focus:bg-white"> 
     </div> 
     <div class="relative"> <i class="fas fa-key absolute top-4 right-4 text-slate-400"></i> 
      <input type="password" id="sub-pass" placeholder="ูููุฉ ุงููุฑูุฑ" class="w-full border-2 border-slate-200 p-3 pr-10 rounded-xl font-bold outline-none focus:border-brand-500 focus:ring-4 focus:ring-brand-500/10 transition-all bg-slate-50 focus:bg-white"> 
     </div> 
    </div> <button onclick="app.loginSubscriber()" class="w-full bg-brand-600 text-white py-4 rounded-xl font-black shadow-lg shadow-brand-500/30 mt-6 hover:bg-brand-700 hover:scale-[1.02] transition-all">ุชุณุฌูู ุฏุฎูู ุขูู</button> <button onclick="document.getElementById('subscriber-login-modal').classList.add('hidden')" class="mt-4 text-slate-400 font-bold text-sm hover:text-slate-600">ุฅูุบุงุก ูุงูุนูุฏุฉ</button> 
   </div> 
  </div> 

  <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) { if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) || (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) || (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) || (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0))) { return false; } }
        const firebaseConfig = {
            apiKey: "AIzaSyDvFOWeYV2grWux_Z-nl3uFiTR2Jd9UlvE",
            authDomain: "tgrep-11831.firebaseapp.com",
            databaseURL: "https://tgrep-11831-default-rtdb.firebaseio.com",
            projectId: "tgrep-11831",
            storageBucket: "tgrep-11831.firebasestorage.app",
            messagingSenderId: "129365723816",
            appId: "1:129365723816:web:be1fb88079c9a38ac2d09d"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dbRef = database.ref('edu_platform_data');
        let db = { quizzes: [], files: [], simulations: [], settings: {}, users: [], majors: [], majorConfigs: {} };
        let state = { isVIP: false, major: '', minor: '', quiz: null, score: 0, qIdx: 0, timerInterval: null, pendingAction: null, answers: [], heavyDataLoaded: false };
        
        const app = {
            init: () => {
                setTimeout(() => { const l = document.getElementById('loading'); if(!l.classList.contains('hidden')) { document.getElementById('loading-text').innerText = "ูุจุฏู ุฃู ุงูุงุชุตุงู ุจุทูุก..."; document.getElementById('retry-btn').classList.remove('hidden'); } }, 10000);
                
                database.ref('edu_platform_data/stats/visitors').transaction(current => { return (current || 0) + 1; });

                dbRef.child('settings').once('value').then(snap => {
                    db.settings = snap.val() || {};
                    const loader = document.getElementById('loading');
                    loader.style.opacity = '0';
                    setTimeout(() => loader.classList.add('hidden'), 500); 
                    
                    app.renderUI();
                    
                    // ููุง ุชู ุญู ุงููุดููุฉ: ุงูุชุฃูุฏ ูู ุงูุฌูุณุฉ ูุชูุฌูู ุงููุณุชุฎุฏู ูููุญุชู ููุฑุงู ุฅุฐุง ูุงู ูุณุฌูุงู
                    const hasSession = app.checkSession();
                    app.fetchMajors();
                    
                    const urlParams = new URLSearchParams(window.location.search);
                    if(urlParams.get('quiz')) {
                        app.checkUrlParams();
                        app.loadHeavyData(); 
                    } else {
                        // ูุง ุชุธูุฑ ุตูุญุฉ ุงูุจุฏุงูุฉ ุฅูุง ุฅุฐุง ูู ููู ูุณุฌูุงู ุงูุฏุฎูู
                        if(!hasSession) {
                            app.showSection('landing');
                        }
                        app.loadHeavyData(); 
                    }
                }).catch(err => { console.error(err); document.getElementById('loading-text').innerText = "ุฎุทุฃ ูู ุงูุงุชุตุงูุ ุชุฃูุฏ ูู ุงูุฅูุชุฑูุช"; document.getElementById('retry-btn').classList.remove('hidden'); });
            },
            
            checkUrlParams: () => {
                const urlParams = new URLSearchParams(window.location.search);
                const quizId = urlParams.get('quiz');
                
                if (quizId) {
                    app.notify("ุฌุงุฑู ุชุฌููุฒ ุงูุงุฎุชุจุงุฑ ุงููุทููุจ...", "success");
                    database.ref('edu_platform_data/quizzes').orderByChild('id').equalTo(Number(quizId)).once('value')
                    .then(snap => {
                        if (snap.exists()) {
                            const qData = snap.val();
                            const qKey = Object.keys(qData)[0]; 
                            const q = qData[qKey];
                            
                            if(!db.quizzes) db.quizzes = [];
                            if(!db.quizzes.find(x => x.id === q.id)) db.quizzes.push(q);
                            
                            const locked = q.mode === 'subscriber' && !state.isVIP;
                            app.startQuiz(q.id, locked);
                        } else {
                            app.notify("ุนุฐุฑุงูุ ูุฐุง ุงูุงุฎุชุจุงุฑ ุบูุฑ ููุฌูุฏ ุฃู ุชู ุญุฐูู", "error");
                            app.showSection('landing');
                        }
                    }).catch(err => {
                        console.error(err);
                        app.notify("ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช", "error");
                        app.showSection('landing');
                    });
                }
            },

            returnToHome: () => {
                if(state.timerInterval) clearInterval(state.timerInterval);
                
                if (window.history.replaceState) {
                    window.history.replaceState(null, null, window.location.pathname);
                }
                
                document.getElementById('exam-player').classList.add('hidden');
                document.getElementById('result-box').classList.add('hidden');
                document.getElementById('question-box').classList.add('hidden');
                
                if(state.isVIP) {
                    app.showSection('dashboard');
                } else {
                    app.showSection('landing'); 
                }
            },

            shareQuiz: (e, id) => {
                e.stopPropagation(); 
                const link = window.location.origin + window.location.pathname + "?quiz=" + id;
                navigator.clipboard.writeText(link).then(() => {
                    app.notify("ุชู ูุณุฎ ุฑุงุจุท ุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ! ููููู ุฅุฑุณุงูู ูุฃุตุฏูุงุฆู ๐", "success");
                }).catch(err => {
                    app.notify("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุณุฎ ุงูุฑุงุจุท", "error");
                });
            },

            loadHeavyData: () => {
                Promise.all([
                    dbRef.child('simulations').once('value'),
                    dbRef.child('quizzes').once('value'),
                    dbRef.child('files').once('value'),
                    dbRef.child('majorConfigs').once('value')
                ]).then(results => {
                    db.simulations = results[0].val() || [];
                    const incomingQuizzes = results[1].val() || [];
                    if(db.quizzes && db.quizzes.length > 0) {
                        incomingQuizzes.forEach(iq => {
                            if(!db.quizzes.find(xq => xq.id === iq.id)) db.quizzes.push(iq);
                        });
                    } else {
                        db.quizzes = incomingQuizzes;
                    }
                    db.files = results[2].val() || [];
                    db.majorConfigs = results[3].val() || {};
                    state.heavyDataLoaded = true;
                });
            },
            ensureDataReady: (callback) => {
                if(state.heavyDataLoaded) {
                    callback();
                } else {
                    app.notify("ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุฃูุณุงูุ ูุญุธุฉ ูุงุญุฏุฉ...", "success");
                    const check = setInterval(() => {
                        if(state.heavyDataLoaded) {
                            clearInterval(check);
                            callback();
                        }
                    }, 200);
                }
            },
            fetchMajors: () => {
                dbRef.child('majors').on('value', snap => {
                    db.majors = snap.val() || ['ูุบุฉ ุนุฑุจูุฉ', 'ุฑูุงุถูุงุช', 'ุนููู', 'ุฏุฑุงุณุงุช', 'ูุบุฉ ุฅูุฌููุฒูุฉ'];
                    app.renderMajorsGrid();
                });
            },
            renderMajorsGrid: () => {
                const grid = document.getElementById('majors-grid');
                let html = `
                <button onclick="app.selectMajor('GeneralFiles')" class="col-span-2 md:col-span-3 bg-gradient-to-br from-red-500 to-rose-600 text-white p-8 rounded-[2rem] shadow-lg border-b-8 border-red-800 hover:scale-[1.01] transition-all flex items-center justify-center gap-4 relative overflow-hidden group"> 
                    <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div> <i class="fas fa-folder-open text-5xl text-yellow-200 drop-shadow-md"></i> 
                    <div class="text-right z-10"> <span class="block font-black text-2xl">ููุชุจุฉ ุงููููุงุช ุงูุดุงููุฉ</span> <span class="text-red-100 text-sm font-bold">ูู ุงููููุงุช ุงููุงูุฉ ูู ููุงู ูุงุญุฏ</span> </div> 
                </button>`;

                const getColorForString = (str) => {
                    const colors = ['emerald', 'blue', 'purple', 'rose', 'cyan', 'indigo', 'teal'];
                    let hash = 0;
                    for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
                    return colors[Math.abs(hash) % colors.length];
                };

                db.majors.forEach(m => {
                    if (m === 'Competition' || m === 'GeneralFiles' || m === 'Universal') return; 
                    const color = getColorForString(m);
                    
                    html += `
                    <button onclick="app.selectMajor('${m}')" class="hover-card bg-white p-6 rounded-3xl shadow border-b-8 border-${color}-500 text-slate-700 font-black text-lg hover:-translate-y-1 transition-all">
                        <i class="fas fa-book-open block text-3xl mb-2 text-${color}-500"></i> ${m}
                    </button>`;
                });
                grid.innerHTML = html;
            },
            openSimulationsSection: () => {
                app.ensureDataReady(() => {
                     const simList = document.getElementById('simulations-list');
                     simList.innerHTML = "";
                     if(db.simulations && db.simulations.length) {
                        db.simulations.forEach(sim => {
                            const locked = sim.mode === 'subscriber' && !state.isVIP;
                            simList.innerHTML += ` <div onclick="app.startSimulation(${sim.id}, ${locked})" class="w-full bg-white p-6 rounded-[2rem] shadow-md border-r-8 border-yellow-400 cursor-pointer hover:-translate-y-1 transition-all group ${locked?'locked-item':''}"> <div class="flex items-center justify-between"> <div class="flex items-center gap-4"> <div class="bg-yellow-50 p-3 rounded-full group-hover:bg-yellow-100 transition-colors"> <i class="fas fa-stopwatch text-3xl text-yellow-500"></i> </div> <div class="text-right"> <h3 class="text-xl font-black text-slate-800">${sim.name}</h3> <p class="text-xs text-slate-500 font-bold mt-1">${sim.targetMajor ? 'ุชุฎุตุต: ' + sim.targetMajor : 'ุดุงูู ูุฌููุน ุงูุชุฎุตุตุงุช'}</p> </div> </div> <div class="flex flex-col items-center bg-slate-50 p-3 rounded-xl min-w-[80px]"> <i class="fas ${locked?'fa-lock text-red-500':'fa-play text-green-500'} text-xl mb-1"></i> <span class="text-[10px] font-bold text-slate-500">${sim.time} ุฏูููุฉ</span> </div> </div> </div>`;
                        });
                     } else {
                         simList.innerHTML = `<div class="text-center p-8 bg-white rounded-2xl shadow border border-slate-100"><i class="fas fa-box-open text-4xl text-slate-300 mb-2"></i><p class="text-slate-500 font-bold">ูุง ุชูุฌุฏ ูุญุงููุงุช ูุชุงุญุฉ ุญุงููุงู</p></div>`;
                     }
                     app.showSection('simulations-view');
                });
            },
            notify: (msg, type='success') => { const t = document.getElementById('toast-notification'); const i = document.getElementById('toast-icon'); const m = document.getElementById('toast-msg'); if(type === 'error') { t.className = 'bg-red-600 text-white shadow-red-500/50'; i.className = 'fas fa-exclamation-triangle'; } else { t.className = 'bg-emerald-600 text-white shadow-emerald-500/50'; i.className = 'fas fa-check-circle'; } m.innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); },
            loginSubscriber: () => { const uInput = document.getElementById('sub-user').value.trim(); const pInput = document.getElementById('sub-pass').value.trim(); if(!uInput || !pInput) return app.notify("ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู ููููุฉ ุงููุฑูุฑ", "error"); app.notify("ุฌุงุฑู ุงูุชุญูู...", "success"); database.ref('edu_platform_data/users').orderByChild('username').equalTo(uInput).once('value', snap => { if (!snap.exists()) return app.notify("ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ", "error"); let foundUser = null; let foundKey = null; snap.forEach(childSnapshot => { const u = childSnapshot.val(); if(u.password === pInput) { foundUser = u; foundKey = childSnapshot.key; } }); if(!foundUser) return app.notify("ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ", "error"); if(!foundUser.isActive) return app.notify("ุนุฐุฑุงูุ ูุฐุง ุงูุญุณุงุจ ููููู", "error"); if(Date.now() > foundUser.expiryDate) return app.notify("ุงูุชูุช ุตูุงุญูุฉ ุงุดุชุฑุงูู", "error"); const sessionToken = Date.now() + "_" + Math.random().toString(36).substr(2, 9); database.ref(`edu_platform_data/users/${foundKey}/sessionToken`).set(sessionToken) .then(() => { database.ref(`edu_platform_data/users/${foundKey}/lastLogin`).set(Date.now()); localStorage.setItem('vip_session', sessionToken); localStorage.setItem('vip_uid', foundKey); localStorage.setItem('vip_name', foundUser.username); app.activateVIP(foundUser.username, foundKey); document.getElementById('subscriber-login-modal').classList.add('hidden'); app.notify(`ุฃููุงู ุจู ูุง ${foundUser.username} ๐`); }).catch(err => { console.error(err); app.notify("ุฎุทุฃ ูู ุจุฏุก ุงูุฌูุณุฉ", "error"); }); }).catch(err => { app.notify("ุฎุทุฃ ูู ุงูุงุชุตุงู: " + err.message, "error"); }); },
            checkSession: () => { 
                const localToken = localStorage.getItem('vip_session'); 
                const localUid = localStorage.getItem('vip_uid'); 
                const localName = localStorage.getItem('vip_name'); 
                if(localToken && localUid) { 
                    app.monitorSession(localUid, localToken); 
                    app.activateVIP(localName || 'ูุดุชุฑู', localUid); 
                    return true;
                } 
                return false;
            },
            monitorSession: (uid, localToken) => { const userTokenRef = database.ref(`edu_platform_data/users/${uid}/sessionToken`); userTokenRef.on('value', snap => { const serverToken = snap.val(); if (serverToken && serverToken !== localToken) { userTokenRef.off(); app.logoutForce(true); } }); const userActiveRef = database.ref(`edu_platform_data/users/${uid}/isActive`); userActiveRef.on('value', snap => { if (snap.exists() && snap.val() === false) { userActiveRef.off(); localStorage.clear(); document.getElementById('custom-alert-msg').innerText = "โ ุชู ุฅููุงู ุญุณุงุจู ูู ูุจู ุงูุฅุฏุงุฑุฉ."; document.getElementById('custom-alert-modal').classList.remove('hidden'); } }); },
            activateVIP: (name, uid) => { 
                state.isVIP = true; 
                app.updateStatus(name); 
                if(state.pendingAction) { 
                    state.pendingAction(); 
                    state.pendingAction = null; 
                } else { 
                    const urlParams = new URLSearchParams(window.location.search);
                    if(!urlParams.get('quiz')) {
                        app.showSection('dashboard'); 
                    }
                } 
            },
            logoutForce: (kicked = false) => { localStorage.clear(); if(kicked) { document.getElementById('custom-alert-msg').innerText = "โ๏ธ ุชู ุชุณุฌูู ุงูุฏุฎูู ูู ุฌูุงุฒ ุขุฎุฑ.\nูุง ูููู ูุชุญ ุงูุญุณุงุจ ุนูู ุฌูุงุฒูู ูู ููุณ ุงูููุช."; document.getElementById('custom-alert-modal').classList.remove('hidden'); } else { location.reload(); } },
            renderUI: () => { const s = db.settings || {}; const els = { 'ui-site-name': s.siteName, 'ui-hero-title': s.heroTitle, 'ui-hero-desc': s.heroDesc, 'footer-text': s.footerText, 'ui-app-text': s.appText, 'ui-ext-text': s.extLinkText, 'ui-btn-vis': s.btnVisitor, 'ui-btn-sub': s.btnSub, }; for(let k in els) if(document.getElementById(k)) document.getElementById(k).innerText = els[k] || ""; const waLink = document.getElementById('whatsapp-link'); const tgLink = document.getElementById('telegram-link'); if(s.whatsapp) { waLink.href = `https://wa.me/${s.whatsapp}`; waLink.classList.remove('hidden'); } else { waLink.classList.add('hidden'); } if(s.telegram) { tgLink.href = `https://t.me/${s.telegram}`; tgLink.classList.remove('hidden'); } else { tgLink.classList.add('hidden'); } if(s.tutorialText && s.tutorialText.trim() !== "") { document.getElementById('ui-tutorial-box').classList.remove('hidden'); document.getElementById('ui-tutorial-text').innerText = s.tutorialText; } else document.getElementById('ui-tutorial-box').classList.add('hidden'); if(s.extLinkUrl) { document.getElementById('ui-ext-link-area').classList.remove('hidden'); document.getElementById('ui-ext-link').href = s.extLinkUrl; } if(s.appLink) { document.getElementById('app-banner').classList.remove('hidden'); document.getElementById('ui-app-link').href = s.appLink; } },
            showSection: (id) => { document.querySelectorAll('.view-section').forEach(e=>e.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); window.scrollTo(0,0); },
            enterVisitor: () => { state.isVIP = false; app.updateStatus(); app.showSection('dashboard'); },
            enterSubscriber: () => { state.pendingAction = null; document.getElementById('subscriber-login-modal').classList.remove('hidden'); },
            updateStatus: (name) => document.getElementById('user-status').innerText = state.isVIP ? `ูุฑุญุจุงูุ ${name} (VIP) ๐` : "ุฒุงุฆุฑ (ุตูุงุญูุงุช ูุญุฏูุฏุฉ)",
            selectMajor: (m) => { 
                app.ensureDataReady(() => {
                    state.major = m; 
                    
                    if (m === 'GeneralFiles') {
                        state.minor = 'all'; 
                        document.getElementById('list-title').innerText = "ููุชุจุฉ ุงููููุงุช ุงูุดุงููุฉ";
                        app.renderFilesDirectly(); 
                        return;
                    }

                    document.getElementById('major-title').innerText = m;
                    const subGrid = document.getElementById('sub-sections-grid');
                    
                    const config = db.majorConfigs && db.majorConfigs[m] ? db.majorConfigs[m] : {type: 'standard'};
                    
                    let buttonsHtml = '';

                    if (config.type === 'custom') {
                        const branches = config.branches || [];
                        if(branches.length > 0) {
                            buttonsHtml = branches.map(b => 
                                `<button onclick="app.selectMinor('${b}')" class="p-8 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all text-lg">${b}</button>`
                            ).join('');
                        } else {
                            buttonsHtml = `<div class="col-span-3 text-center text-slate-400 font-bold p-8">ูุง ุชูุฌุฏ ุฃูุณุงู ูุฑุนูุฉ ูุถุงูุฉ ููุฐุง ุงููุณู ุงููุฎุตุต</div>`;
                        }
                    } else {
                        buttonsHtml = `
                            <button onclick="app.selectMinor('ุชุฎุตุต')" class="md:col-span-2 lg:col-span-3 p-8 bg-slate-800 text-white rounded-[2rem] shadow-xl border-r-[8px] border-yellow-400 flex justify-between items-center hover:bg-slate-900 transition-all group"> 
                                <div class="text-right"> <h4 class="text-3xl font-black mb-1">ุฃุณุฆูุฉ ุงูุชุฎุตุต</h4> <p class="text-slate-400 font-bold text-sm group-hover:text-yellow-400 transition-colors">ุจูู ุฃุณุฆูุฉ ุดุงูู ูุชุฎุตุตู</p> </div> <i class="fas fa-star text-5xl text-yellow-400 group-hover:scale-110 transition-transform"></i> 
                            </button> 
                            <button onclick="app.selectMinor('ุชุฑุจูู')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">ุงูุชุฑุจูู</button> 
                            <button onclick="app.selectMinor('ุฌุฏุงุฑุงุช')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">ุงูุฌุฏุงุฑุงุช ุงูุณููููุฉ</button> 
                            <button onclick="app.selectMinor('IQ')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">IQ ูุงูุฐูุงุก</button> 
                            <button onclick="app.selectMinor('ุนุฑุจู ููุฌููุน')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">ูุบุฉ ุนุฑุจูุฉ (ุนุงู)</button> 
                            <button onclick="app.selectMinor('ุงูุฌููุฒู ููุฌููุน')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">ูุบุฉ ุฅูุฌููุฒูุฉ (ุนุงู)</button> 
                            <button onclick="app.selectMinor('ุญุงุณุจ ุขูู')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all text-blue-700">ุญุงุณุจ ุขูู</button> 
                            <button onclick="app.selectMinor('ูุนูููุงุช ุนุงูุฉ')" class="p-6 bg-white rounded-2xl shadow font-bold hover:bg-slate-50 text-right border-r-4 border-transparent hover:border-brand-500 transition-all">ูุนูููุงุช ุนุงูุฉ</button>
                        `;
                    }

                    subGrid.innerHTML = buttonsHtml;
                    app.showSection('sub-dashboard'); 
                });
            },
            renderFilesDirectly: () => {
                const files = (db.files||[]).filter(f => f.major === 'GeneralFiles'); 
                
                const fBox = document.getElementById('files-box'); 
                const fGrid = document.getElementById('files-grid'); 
                
                if(files.length) { 
                    fBox.classList.remove('hidden'); 
                    fGrid.innerHTML = files.map(f => { 
                        const locked = f.mode === 'subscriber' && !state.isVIP; 
                        return ` <div onclick="app.openFile('${f.url}', ${locked})" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-50 transition-colors ${locked?'locked-item':''}"> <div class="flex items-center gap-3"> <div class="bg-red-50 p-2 rounded-lg"><i class="fas fa-file-pdf text-red-500 text-xl"></i></div> <span class="font-bold text-sm text-slate-700">${f.name}</span> <span class="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded">(${f.minor})</span> </div> <i class="fas ${locked?'fa-lock text-slate-300':'fa-download text-brand-500'}"></i> </div>`; 
                    }).join(''); 
                } else {
                    fBox.classList.remove('hidden'); 
                    fGrid.innerHTML = '<div class="col-span-2 text-center text-slate-400 p-4 font-bold">ูุง ุชูุฌุฏ ูููุงุช ุญุงููุงู</div>';
                }

                document.getElementById('quizzes-box').classList.add('hidden');
                app.showSection('content-list');
            },
            selectMinor: (m) => { 
                state.minor = m; 
                document.getElementById('list-title').innerText = m === 'ุชุฎุตุต' ? `ุชุฎุตุต ${state.major}` : m; 
                
                const currentConfig = db.majorConfigs?.[state.major] || {type: 'standard'};
                const isCustom = currentConfig.type === 'custom';

                const quizzes = (db.quizzes||[]).filter(q => { 
                    if (isCustom) {
                        return q.major === state.major && q.minor === m;
                    } else {
                        return q.minor === m && (q.major === 'Universal' || !q.major || q.major === state.major);
                    }
                }); 
                
                const qBox = document.getElementById('quizzes-box'); 
                const qGrid = document.getElementById('quizzes-grid'); 
                
                if(quizzes.length) { 
                    qBox.classList.remove('hidden'); 
                    qGrid.innerHTML = quizzes.map(q => { 
                        const locked = q.mode === 'subscriber' && !state.isVIP; 
                        return ` <div onclick="app.startQuiz(${q.id}, ${locked})" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-50 transition-colors ${locked?'locked-item':''}"> <div class="flex items-center gap-3"> <div class="bg-blue-50 p-2 rounded-lg"><i class="fas fa-clipboard-list text-blue-500 text-xl"></i></div> <div> <h4 class="font-bold text-slate-800">${q.name}</h4> <p class="text-[10px] text-slate-400 font-bold">${q.questions?.length||0} ุณุคุงู</p> </div> </div> <div class="flex items-center gap-3"><button onclick="app.shareQuiz(event, ${q.id})" class="p-2 bg-slate-50 hover:bg-slate-200 rounded-lg transition-colors z-10 relative" title="ูุณุฎ ุฑุงุจุท ุงูุงุฎุชุจุงุฑ"><i class="fas fa-share-alt text-slate-500"></i></button><i class="fas ${locked?'fa-lock text-red-400':'fa-play-circle text-brand-500'} text-2xl"></i></div> </div>`; 
                    }).join(''); 
                } else { 
                    qGrid.innerHTML = '<div class="text-center bg-slate-50 p-6 rounded-2xl border border-slate-200 text-slate-400 font-bold">ูุง ููุฌุฏ ุงุฎุชุจุงุฑุงุช ูุถุงูุฉ ูู ูุฐุง ุงููุณู</div>'; 
                    qBox.classList.remove('hidden'); 
                } 

                const fBox = document.getElementById('files-box');
                const fGrid = document.getElementById('files-grid');
                const files = (db.files||[]).filter(f => f.major===state.major && f.minor===m);
                if(files.length) {
                     fBox.classList.remove('hidden'); 
                     fGrid.innerHTML = files.map(f => ` <div onclick="app.openFile('${f.url}', ${f.mode === 'subscriber' && !state.isVIP})" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex justify-between items-center cursor-pointer hover:bg-slate-50 transition-colors"> <div class="flex items-center gap-3"> <div class="bg-red-50 p-2 rounded-lg"><i class="fas fa-file-pdf text-red-500 text-xl"></i></div> <span class="font-bold text-sm text-slate-700">${f.name}</span> </div> <i class="fas fa-download text-brand-500"></i> </div>`).join('');
                } else {
                    fBox.classList.add('hidden');
                }

                app.showSection('content-list'); 
            },
            backFromContent: () => {
                if(state.major === 'GeneralFiles') {
                    app.showSection('dashboard');
                } else {
                    app.showSection('sub-dashboard');
                }
            },
            openFile: (url, locked) => { if(locked) { state.pendingAction = () => window.open(url, '_blank'); document.getElementById('subscriber-login-modal').classList.remove('hidden'); } else { window.open(url, '_blank'); } },
            startQuiz: (id, locked) => { 
                if(locked) { 
                    state.pendingAction = () => app.startQuiz(id, false); 
                    document.getElementById('subscriber-login-modal').classList.remove('hidden'); 
                    return; 
                } 
                const q = db.quizzes.find(x => x.id === id); 
                if(!q || !q.questions || !q.questions.length) return app.notify("ุนุฐุฑุงูุ ูุฐุง ุงูุงุฎุชุจุงุฑ ูุง ูุญุชูู ุนูู ุฃุณุฆูุฉ", "error"); 
                state.quiz = { questions: q.questions.map(qt => ({...qt, categoryName: q.name})) }; 
                state.score = 0; 
                state.qIdx = 0; 
                state.answers = new Array(q.questions.length).fill(null); 
                document.getElementById('timer-display').classList.add('hidden'); 
                app.showSection('exam-player'); 
                app.renderQ(); 
            },
            startSimulation: (id, locked) => { if(locked) { state.pendingAction = () => app.startSimulation(id, false); document.getElementById('subscriber-login-modal').classList.remove('hidden'); return; } const sim = db.simulations.find(x => x.id === id); if(!sim) return; let allQs = db.quizzes || []; const getPool = (majorFilter, minorFilter, count, label) => { let pool = []; allQs.forEach(q => { let matchMajor = majorFilter ? q.major === majorFilter : true; let matchMinor = q.minor === minorFilter; if(matchMajor && matchMinor && q.questions) pool.push(...q.questions); }); pool.sort(() => 0.5 - Math.random()); return pool.slice(0, count).map(q => ({ ...q, categoryName: label })); }; let finalQuestions = []; if(sim.targetMajor) finalQuestions.push(...getPool(sim.targetMajor, 'ุชุฎุตุต', sim.counts.spec, `ุชุฎุตุต: ${sim.targetMajor}`)); finalQuestions.push(...getPool(null, 'ุชุฑุจูู', sim.counts.ped, 'ุฃุณุฆูุฉ ุชุฑุจููุฉ')); finalQuestions.push(...getPool(null, 'ุฌุฏุงุฑุงุช', sim.counts.comp, 'ุงูุฌุฏุงุฑุงุช ุงูุณููููุฉ')); finalQuestions.push(...getPool(null, 'IQ', sim.counts.iq, 'IQ ูุงูุฐูุงุก')); finalQuestions.push(...getPool(null, 'ุนุฑุจู ููุฌููุน', sim.counts.ar, 'ูุบุฉ ุนุฑุจูุฉ (ุนุงู)')); finalQuestions.push(...getPool(null, 'ุงูุฌููุฒู ููุฌููุน', sim.counts.en, 'ูุบุฉ ุฅูุฌููุฒูุฉ (ุนุงู)')); finalQuestions.push(...getPool(null, 'ุญุงุณุจ ุขูู', sim.counts.cs, 'ุญุงุณุจ ุขูู')); finalQuestions.push(...getPool(null, 'ูุนูููุงุช ุนุงูุฉ', sim.counts.gen, 'ูุนูููุงุช ุนุงูุฉ')); if(!finalQuestions.length) return app.notify("ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุงููุฉ ูุฅูุดุงุก ูุฐุง ุงููุญุงูู", "error"); state.quiz = { questions: finalQuestions }; state.score = 0; state.qIdx = 0; state.answers = new Array(finalQuestions.length).fill(null); app.startTimer(sim.time); app.showSection('exam-player'); app.renderQ(); },
            startTimer: (min) => { const d = document.getElementById('timer-display'); d.classList.remove('hidden'); let t = min * 60; if(state.timerInterval) clearInterval(state.timerInterval); state.timerInterval = setInterval(() => { let m = Math.floor(t/60); let s = t%60; d.innerText = `${m}:${s<10?'0'+s:s}`; if(t-- <= 0) { clearInterval(state.timerInterval); app.notify("ุงูุชูู ุงูููุช ุงููุญุฏุฏ ููุงุฎุชุจุงุฑ", "error"); app.finishExam(); } }, 1000); },
            renderQ: () => { document.getElementById('question-box').classList.remove('hidden'); document.getElementById('result-box').classList.add('hidden'); const q = state.quiz.questions[state.qIdx]; const progress = ((state.qIdx+1)/state.quiz.questions.length*100); document.getElementById('progress-text').innerText = `ุณุคุงู ${state.qIdx+1} ูู ${state.quiz.questions.length}`; document.getElementById('progress-bar').style.width = progress+"%"; document.getElementById('question-box').innerHTML = ` <div class="bg-white p-8 rounded-[2.5rem] shadow-xl space-y-6 border border-slate-100"> <div class="flex justify-between items-center border-b pb-4"> <span class="text-xs font-black bg-slate-100 text-slate-600 px-4 py-2 rounded-full tracking-wide">${q.categoryName || 'ุณุคุงู ุนุงู'}</span> </div> <h3 class="font-black text-xl md:text-2xl leading-relaxed text-slate-800">${q.text}</h3> <div class="grid gap-4 mt-6"> ${q.opts.map((o,i)=>`<button onclick="app.ans(${i},this)" class="opt-btn group"><span class="absolute right-4 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full border-2 border-slate-200 flex items-center justify-center text-xs text-slate-400 group-hover:border-brand-500 group-hover:text-brand-500 font-bold transition-colors">${['ุฃ','ุจ','ุฌ','ุฏ'][i]}</span><span class="mr-10 block">${o}</span></button>`).join('')} </div> </div>`; },
            ans: (i, btn) => { const q = state.quiz.questions[state.qIdx]; state.answers[state.qIdx] = i; document.querySelectorAll('.opt-btn').forEach(b=>b.disabled=true); const correctIdx = parseInt(q.correctAnswer); if(i === correctIdx) { btn.classList.add('correct'); state.score++; app.notify("ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุฃุญุณูุช", "success"); } else { btn.classList.add('wrong'); document.querySelectorAll('.opt-btn')[correctIdx].classList.add('correct'); app.notify("ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ", "error"); } setTimeout(() => { if(++state.qIdx < state.quiz.questions.length) app.renderQ(); else app.finishExam(); }, 1500); },
            finishExam: () => { if(state.timerInterval) clearInterval(state.timerInterval); document.getElementById('question-box').classList.add('hidden'); document.getElementById('result-box').classList.remove('hidden'); const total = state.quiz.questions.length; const percentage = Math.round(state.score/total*100); let currentScore = 0; const scoreInterval = setInterval(() => { if(currentScore >= percentage) { clearInterval(scoreInterval); document.getElementById('res-score').innerText = percentage + "%"; } else { currentScore++; document.getElementById('res-score').innerText = currentScore + "%"; } }, 20); let msg = percentage >= 90 ? "ููุชุงุฒ! ูุณุชูู ุฑุงุฆุน ุฌุฏุงู ๐" : percentage >= 75 ? "ุฌูุฏ ุฌุฏุงู! ุงุณุชูุฑ ูู ุงูุชูุฏู ๐ช" : percentage >= 50 ? "ุฌูุฏุ ููู ุชุญุชุงุฌ ูููุฒูุฏ ูู ุงููุฑุงุฌุนุฉ ๐" : "ุชุญุชุงุฌ ููุฐุงูุฑุฉ ููุซูุฉ ูุชุญุณูู ูุณุชูุงู ๐"; document.getElementById('res-msg').innerText = msg; const reviewList = document.getElementById('review-list'); reviewList.innerHTML = state.quiz.questions.map((q, idx) => { const userAnsIdx = state.answers[idx]; const isCorrect = userAnsIdx === q.correctAnswer; return ` <div class="review-card p-6 rounded-3xl shadow-sm text-right bg-white border border-slate-100 ${isCorrect ? 'correct-ans' : 'wrong-ans'}"> <div class="flex justify-between mb-2"> <span class="text-[10px] font-bold text-slate-400 bg-slate-50 px-2 py-1 rounded-lg">${q.categoryName}</span> <span class="text-xs font-bold ${isCorrect?'text-green-600':'text-red-500'}">${isCorrect?'ุตุญูุญุฉ โ':'ุฎุงุทุฆุฉ โ'}</span> </div> <p class="font-bold text-slate-800 mb-3 text-sm md:text-base leading-relaxed">${idx+1}. ${q.text}</p> <div class="text-xs space-y-2 bg-slate-50 p-3 rounded-xl"> <p class="${isCorrect ? 'text-green-700' : 'text-red-600'} font-bold flex items-center gap-2"> <span class="opacity-70 w-12">ุฅุฌุงุจุชู:</span> <span class="flex-1 border-r-2 border-slate-300 pr-2">${userAnsIdx !== null ? q.opts[userAnsIdx] : "ูู ูุชู ุงูุงุฎุชูุงุฑ"}</span> </p> ${!isCorrect ? `<p class="text-green-700 font-bold flex items-center gap-2 border-t border-slate-200 pt-2"><span class="opacity-70 w-12">ุงูุตุญูุญุฉ:</span> <span class="flex-1 border-r-2 border-green-300 pr-2">${q.opts[q.correctAnswer]}</span></p>` : ''} </div> </div>`; }).join(''); window.scrollTo(0,0); }
        };
        app.init();
    </script> 
 
</body></html>